--drop database demo;
--create database demo
--go
--use demo
--go

drop table Mail_template;
drop table Stu_additional;
drop table Member_status;
drop table Test_Date;
drop table Test_interval;
drop table Examiner_offday;
drop table Employee;
drop table Student;
drop table Sign_list;
drop table Test_period;
drop table Class;
drop table Edu;

--drop view view_examinerr;
--drop view view_Member;


create table Edu
(
  edu_id            int   primary key  NOT NULL  identity,  
  edu_name           nvarchar(30)  NOT NULL ,          
  edu_add            nvarchar(30)  NOT NULL,
  edu_tel            nvarchar(15)  NOT NULL,
  edu_contact        nvarchar(10)  NOT NULL
);  


create table Class
(
  class_id             nvarchar(10)  primary key  NOT NULL,     
  class_name           nvarchar(30)  NOT NULL ,           
  class_contact        nvarchar(10) ,
  class_teach          nvarchar(10)  NOT NULL,
  edu_id               int           foreign key references   Edu(edu_id)
);  


/*create table Student
(
  stu_id               nvarchar(10)  primary key  NOT NULL,     
  stu_lastname         nvarchar(4)   NOT NULL ,           
  stu_firstname        nvarchar(8)   NOT NULL,
  stu_tel              nvarchar(15)  UNIQUE NOT NULL,
  stu_mobile           nvarchar(15)  ,
  stu_email            nvarchar(30)  UNIQUE NOT NULL,
  stu_add              nvarchar(30)  ,
  stu_age              int           NOT NULL,
  stu_sch              nvarchar(10),
  stu_dep              nvarchar(30),
  class_id             nvarchar(10)  fk_class_id references  Class(class_id) NOT NULL,
  log_pw               nvarchar(30)  UNIQUE NOT NULL 
);  
*/

create table Student
(
  stu_group            int           NOT NULL,
  stu_note1            nvarchar(100) ,
  stu_id               nvarchar(10)  primary key  NOT NULL,     
  stu_name             nvarchar(10)  NOT NULL ,
  stu_age              int           NOT NULL,
  stu_sch              nvarchar(10)  ,
  stu_sex              nvarchar(2)   ,           
  stu_email            nvarchar(30)  UNIQUE NOT NULL,
  stu_pre              nvarchar(2)   ,
  stu_implement        float        ,
  stu_testtime         time     ,
  stu_interview        float        ,
  stu_total            float        ,
  stu_workdate         date          ,
  stu_except           int           ,
  stu_final            nvarchar(2)   ,
  stu_note2            nvarchar(100) 
);  


create table Sign_list
(
  sl_id                int            primary key  NOT NULL,     
  sl_name              nvarchar(20)   NOT NULL         
);  



create table Employee
(
  emp_id               nvarchar(10)  primary key  NOT NULL,     
  emp_name             nvarchar(20)   NOT NULL ,           
  dep_id               int	         ,     
  dep_name	           nvarchar(30)  NOT NULL ,   
  emp_mail             nvarchar(30)  UNIQUE NOT NULL,
  sl_id                int           foreign key  references  Sign_list(sl_id) NOT NULL   
);  




create table Test_period
(
  test_hour_id           int	       primary key  NOT NULL identity,
  test_hour              time          NOT NULL           
);  



create table Test_interval
(
  test_interval_id      int            NOT NULL  identity , 
  class_id               nvarchar(10)  foreign key  references  Class(class_id) NOT NULL,    
  test_startdate         date     UNIQUE NOT NULL ,           
  test_enddate           date          NOT NULL,
  CONSTRAINT pk_test_interval_id PRIMARY KEY (class_id, test_startdate)
);  




create table Test_Date
(
  test_date_id      int            NOT NULL  identity, 
  class_id               nvarchar(10)  foreign key references  Class(class_id) NOT NULL,    
  test_startdate         date     foreign key  references  Test_interval(test_startdate) NOT NULL, 
  test_hour_id           int	       foreign key  references  Test_period(test_hour_id) NOT NULL,
  test_people            int           NOT NULL, 
  exam_people            int           NOT NULL,
  CONSTRAINT pk_test_date_id PRIMARY KEY (class_id, test_startdate,test_hour_id)
);  


---------------------------------------------------------------------------------------------------
create table Member_status
(
  sta_id           int	          primary key  NOT NULL,
  sta_name         nvarchar(10)   NOT NULL           
); 


/*
 create table Member_test
(
  stu_id           nvarchar(10)   fk_stu_id references  Student(stu_id) NOT NULL, 
  test_startdate   timestamp      fk_test_startdate references  Test_interval(test_startdate) NOT NULL,
  test_hour_id     int	          fk_test_hour_id references  Test_period(test_hour_id) NOT NULL,
  mem_applytime    timestamp      UNIQUE NOT NULL,
  mem_implement    double,
  mem_interview    double,
  sta_id           int            fk_sta_id references  Member_status(sta_id) NOT NULL ,
  emp_id           nvarchar(10)   fk_emp_id references  Employee(emp_id) NOT NULL,
  mem_checktime    timestamp,
  CONSTRAINT pk_Member_test PRIMARY KEY (stu_id , test_startdate,test_hour_id)
); 
*/


 create table Stu_additional
(
  stu_id           nvarchar(10)   foreign key references  Student(stu_id) NOT NULL, 
  test_startdate   date      foreign key references  Test_interval(test_startdate) NOT NULL,
  test_hour_id     int	          foreign key references  Test_period(test_hour_id) NOT NULL,
  stu_applytime    time      UNIQUE ,
  sta_id           int            foreign key references  Member_status(sta_id) NOT NULL ,
  emp_id           nvarchar(10)   foreign key references  Employee(emp_id) NOT NULL,
  confirm_time     time,
  class_id         nvarchar(10)  foreign key references  Class(class_id) NOT NULL,
  log_pw           nvarchar(30)  UNIQUE , 
  CONSTRAINT pk_Member_test PRIMARY KEY (stu_id , test_startdate,test_hour_id)
); 



create table Mail_template
(
  mail_id          int	         primary key  NOT NULL  identity, 
  mail_name        nvarchar(10) ,     
  mail_text        nvarchar(250)           
); 




 create table Examiner_offday
(
  emp_id           nvarchar(10)	  foreign key references  Employee(emp_id) NOT NULL, 
  off_startdate     date      NOT NULL,       
  off_enddate      date      NOT NULL, 
  off_day          int            NOT NULL,
  emp_job_id       nvarchar(10)	  foreign key  references  Employee(emp_id) NOT NULL
); 



--create view view_examiner
--as
--select e.emp_id, o.off_stardate, o.off_enddate, o.off_day, o.emp_job_id, e.dep_id
--from Employee e left outer join Examiner_offday o
--on (s.emp_id = o.emp_id)
--inner join Employee e
--on (s.emp_id = e.emp_id)
--where s.sl_id=1 ;


--create view view_Member
--as
--select m.stu_id, s.stu_lastmame, s.stu_firstname, s.stu_tel, s.stu_mobile, s.stu_email, s.stu_add
--from Member_test m inner join Student s
--on (m.stu_id = s.stu_id);


 